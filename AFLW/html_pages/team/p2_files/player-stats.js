(function(){var PLAYERS,root=this;void 0===root.PLAYERS&&(PLAYERS=root.PLAYERS={}),PLAYERS.Player=Backbone.Model.extend({name:function(){return this.get("player.givenName")+" "+this.get("player.surname")},team:function(){return this.get("team.teamAbbr")},value:function(header){var attribute=this.collection._attribute(this.collection.getHeader(header)),value=this.get(attribute)||"0";return value===this.collection.max(header)&&(value="<strong>"+value+"</strong>"),value},link:function(){return"/players/"+this.name().replace(/[^a-z0-9]/gi,"-").toLowerCase()+"/"}}),PLAYERS.Players=Backbone.Collection.extend({mixin:[Backbone.CollectionSortMixin,Backbone.IndexMixin,Backbone.URLRoutesMixin,Backbone.CollectionAggregatorMixin,Backbone.CollectionPageMixin,Backbone.CachedCollectionMixin],model:PLAYERS.Player,urlRoutes:["afl/statsCentre/players?competitionId=:season_id","afl/statsCentre/players?competitionId=:season_id&roundId=:round_id","afl/statsCentre/players?competitionId=:season_id&roundId=:round_id&matchId=:match_id","afl/statsCentre/players?competitionId=:season_id&roundId=:round_id&matchId=:match_id&teamIds=:team_id"],urlParams:{season_id:null,round_id:null,match_id:null,team_id:null},options:{sort:{sortable:!0,groupLimit:13,headers:[{header:"player",group:"player",attribute:"player.surname",direction:"desc",sort:!0,visible:!0},{header:"team",group:"team",attribute:"team.teamAbbr",direction:"desc",sort:!0,visible:!0},{header:"tKicks",group:"kicks",attribute:"stats.totals.kicks",direction:"desc",sort:!0,visible:!0},{header:"aKicks",group:"kicks",attribute:"stats.averages.kicks",direction:"desc",sort:!0,visible:!0},{header:"tHandballs",group:"handballs",attribute:"stats.totals.handballs",direction:"desc",sort:!0,visible:!0},{header:"aHandballs",group:"handballs",attribute:"stats.averages.handballs",direction:"desc",sort:!0,visible:!0},{header:"tDisposals",group:"disposals",attribute:"stats.totals.disposals",direction:"desc",sort:!0,visible:!0,init:!0,active:!0},{header:"aDisposals",group:"disposals",attribute:"stats.averages.disposals",direction:"desc",sort:!0,visible:!0},{header:"tContestedPossessions",group:"contestedPossessions",attribute:"stats.totals.contestedPossessions",direction:"desc",sort:!0,visible:!1},{header:"aContestedPossessions",group:"contestedPossessions",attribute:"stats.averages.contestedPossessions",direction:"desc",sort:!0,visible:!1},{header:"tUncontestedPossessions",group:"uncontestedPossessions",attribute:"stats.totals.uncontestedPossessions",direction:"desc",sort:!0,visible:!1},{header:"aUncontestedPossessions",group:"uncontestedPossessions",attribute:"stats.averages.uncontestedPossessions",direction:"desc",sort:!0,visible:!1},{header:"disposalEfficiency",group:"disposalEfficiency",attribute:"stats.totals.disposalEfficiency",direction:"desc",sort:!0,visible:!1},{header:"tClangers",group:"clangers",attribute:"stats.totals.clangers",direction:"desc",sort:!0,visible:!1},{header:"aClangers",group:"clangers",attribute:"stats.averages.clangers",direction:"desc",sort:!0,visible:!1},{header:"tMarks",group:"marks",attribute:"stats.totals.marks",direction:"desc",sort:!0,visible:!0},{header:"aMarks",group:"marks",attribute:"stats.averages.marks",direction:"desc",sort:!0,visible:!0},{header:"tContestedMarks",group:"contestedMarks",attribute:"stats.totals.contestedMarks",direction:"desc",sort:!0,visible:!1},{header:"aContestedMarks",group:"contestedMarks",attribute:"stats.averages.contestedMarks",direction:"desc",sort:!0,visible:!1},{header:"tMarksInside50",group:"marksInside50",attribute:"stats.totals.marksInside50",direction:"desc",sort:!0,visible:!1},{header:"aMarksInside50",group:"marksInside50",attribute:"stats.averages.marksInside50",direction:"desc",sort:!0,visible:!1},{header:"tHitouts",group:"hitouts",attribute:"stats.totals.hitouts",direction:"desc",sort:!0,visible:!0},{header:"aHitouts",group:"hitouts",attribute:"stats.averages.hitouts",direction:"desc",sort:!0,visible:!0},{header:"tTotalClearances",group:"totalClearances",attribute:"stats.totals.clearances.totalClearances",direction:"desc",sort:!0,visible:!1},{header:"aTotalClearances",group:"totalClearances",attribute:"stats.averages.clearances.totalClearances",direction:"desc",sort:!0,visible:!1},{header:"tCentreClearances",group:"centreClearances",attribute:"stats.totals.clearances.centreClearances",direction:"desc",sort:!0,visible:!1},{header:"aCentreClearances",group:"centreClearances",attribute:"stats.averages.clearances.centreClearances",direction:"desc",sort:!0,visible:!1},{header:"tStoppageClearances",group:"stoppageClearances",attribute:"stats.totals.clearances.stoppageClearances",direction:"desc",sort:!0,visible:!1},{header:"aStoppageClearances",group:"stoppageClearances",attribute:"stats.averages.clearances.stoppageClearances",direction:"desc",sort:!0,visible:!1},{header:"tRebound50s",group:"rebound50s",attribute:"stats.totals.rebound50s",direction:"desc",sort:!0,visible:!1},{header:"aRebound50s",group:"rebound50s",attribute:"stats.averages.rebound50s",direction:"desc",sort:!0,visible:!1},{header:"tFreesFor",group:"freesFor",attribute:"stats.totals.freesFor",direction:"desc",sort:!0,visible:!0},{header:"aFreesFor",group:"freesFor",attribute:"stats.averages.freesFor",direction:"desc",sort:!0,visible:!0},{header:"tFreesAgainst",group:"freesAgainst",attribute:"stats.totals.freesAgainst",direction:"desc",sort:!0,visible:!0},{header:"aFreesAgainst",group:"freesAgainst",attribute:"stats.averages.freesAgainst",direction:"desc",sort:!0,visible:!0},{header:"tTackles",group:"tackles",attribute:"stats.totals.tackles",direction:"desc",sort:!0,visible:!0},{header:"aTackles",group:"tackles",attribute:"stats.averages.tackles",direction:"desc",sort:!0,visible:!0},{header:"tOnePercenters",group:"onePercenters",attribute:"stats.totals.onePercenters",direction:"desc",sort:!0,visible:!1},{header:"aOnePercenters",group:"onePercenters",attribute:"stats.averages.onePercenters",direction:"desc",sort:!0,visible:!1},{header:"tBounces",group:"bounces",attribute:"stats.totals.bounces",direction:"desc",sort:!0,visible:!1},{header:"aBounces",group:"bounces",attribute:"stats.averages.bounces",direction:"desc",sort:!0,visible:!1},{header:"tInside50s",group:"inside50s",attribute:"stats.totals.inside50s",direction:"desc",sort:!0,visible:!1},{header:"aInside50s",group:"inside50s",attribute:"stats.averages.inside50s",direction:"desc",sort:!0,visible:!1},{header:"tGoals",group:"goals",attribute:"stats.totals.goals",direction:"desc",sort:!0,visible:!0},{header:"aGoals",group:"goals",attribute:"stats.averages.goals",direction:"desc",sort:!0,visible:!0},{header:"tBehinds",group:"behinds",attribute:"stats.totals.behinds",direction:"desc",sort:!0,visible:!0},{header:"aBehinds",group:"behinds",attribute:"stats.averages.behinds",direction:"desc",sort:!0,visible:!0},{header:"tGoalAssists",group:"goalAssists",attribute:"stats.totals.goalAssists",direction:"desc",sort:!0,visible:!1},{header:"aGoalAssists",group:"goalAssists",attribute:"stats.averages.goalAssists",direction:"desc",sort:!0,visible:!1},{header:"goalAccuracy",group:"goalAccuracy",attribute:"stats.totals.goalAccuracy",direction:"desc",sort:!0,visible:!1},{header:"gamesPlayed",group:"gamesPlayed",attribute:"stats.gamesPlayed",secondary:"player.givenName",direction:"desc",sort:!0,visible:!1},{header:"timeOnGroundPercentage",group:"timeOnGroundPercentage",attribute:"stats.timeOnGroundPercentage",direction:"desc",sort:!0,visible:!1},{header:"tDreamTeamPoints",group:"dreamTeamPoints",attribute:"stats.totals.dreamTeamPoints",direction:"desc",sort:!0,visible:!0},{header:"aDreamTeamPoints",group:"dreamTeamPoints",attribute:"stats.averages.dreamTeamPoints",direction:"desc",sort:!0,visible:!0}]},index:{indexable:!0,ignore:["player.givenName","player.surname"],on:"stats.gamesPlayed"},pager:{per_page:20,page:1}},initialize:function(models,options){options.service&&(this.service=options.service),this.setParam("season_id",AFL.Properties.STATS.season_id),this.cache=new AFL.Cache,this._super("initialize",arguments)},parse:function(response){return response.lists},max:function(header){var root=this,attr=this._attribute(this.getHeader(header));return this.cache.getSet("max:"+attr,function(){return root._super("max",[attr])})},sum:function(header){var root=this,attr=this._attribute(this.getHeader(header));return this.cache.getSet("sum:"+attr,function(){return root._super("sum",[attr])})},avg:function(header){var root=this,attr=this._attribute(this.getHeader(header));return this.cache.getSet("avg:"+attr,function(){return root._super("avg",[attr]).toFixed(1)})},error:function(collection){collection.reset(),collection.trigger("empty")},fetch:function(){var options={error:this.error};return this.cache.clear(),Backbone.Collection.prototype.fetch.call(this,options)}}),PLAYERS.PlayerView=Backbone.View.extend({mixin:[Backbone.ViewRowSortMixin],tagName:"tr",initialize:function(){this.template=_.template(this.options.template.html())},render:function(){var content=this.template({item:this.model,view:this});return this.$el.html(content),this}}),PLAYERS.PlayersView=Backbone.View.extend({mixin:[Backbone.ViewSortMixin],events:{"click .sortable":"sort"},initialize:function(){_.bindAll(this,"addOne","render"),this.collection.on("paged",this.render,this),this.collection.on("empty",this.renderEmpty,this)},render:function(){this.collection.cache.clear(),this.collection.trigger("filter:enable"),this.collection.trigger("enable-filters"),this.collection.length&&(this.$el.find("tbody").empty(),this.fragment=document.createDocumentFragment(),_.each(this.collection.models,this.addOne),this.$el.find("tbody").append(this.fragment),this.renderHeader(),this.renderFooter())},addOne:function(model,counter){if(!(counter>19)){var playerClass=_.indexOf(this.collection.models,model)%2===0?"":"stevens",view=new PLAYERS.PlayerView({model:model,template:this.options.templates.player,className:playerClass});this.fragment.appendChild(view.render().el)}},renderHeader:function(){var header=this.$el.find("thead"),template=_.template(this.options.templates.header.html()),content=template({view:this});header.html(content)},renderFooter:function(){var footer=this.$el.find("tfoot"),template=_.template(this.options.templates.footer.html()),content=template({item:this.collection,view:this});footer.html(content)},renderEmpty:function(){this.$el.find("tbody").empty(),this.$el.find("tfoot").empty();var headers=this.collection.countVisibleHeaders(),element='<tr><td colspan="'+headers+'">No data available</td></tr>';this.$el.find("tbody").append(element)},sort:function(element){var header=$(element.currentTarget).data("sort");header&&this.headerSort(header)}}),PLAYERS.FilterView=Backbone.View.extend({mixin:[Backbone.ViewSortMixin],initialize:function(){this.template=_.template(this.options.template.html()),this.on("reset-filters",this.render,this)},render:function(){var content=this.template({item:this});return this.$el.html(content),this}}),PLAYERS.PagerView=Backbone.View.extend({events:{"click .prev":"previous","click .next":"next","click .page":"goTo"},initialize:function(){this.template=_.template(this.options.template.html()),this.collection.on("paged",this.render,this)},render:function(){var pager=this.collection.getPagerInfo(),content=this.template(pager);return this.$el.html(content),this},next:function(){return this.collection.next(),!1},previous:function(){return this.collection.previous(),!1},goTo:function(el,other){var page=$(el.currentTarget).text();return this.collection.goTo(page),!1}}),PLAYERS.Statistics=Backbone.View.extend({events:{"click .filter-column":"applyHeaderVisibility","click #stats-player-more-reset":"resetHeaders",'change .filters select[name="year"]':"filterYear",'change .filters select[name="round"]':"filterRound",'change .filters select[name="match"]':"filterMatch",'change .filters select[name="team"]':"filterTeam"},initialize:function(){this.filters=new PLAYERS.FilterView({el:$("#stats-player-more .groups"),collection:this.collection,template:this.options.templates.filter}),this.filters.trigger("reset-filters"),this.playersView=new PLAYERS.PlayersView({el:$("#player-stats"),collection:this.collection,templates:{player:this.options.templates.player,header:this.options.templates.header,footer:this.options.templates.footer}}),this.pager=new PLAYERS.PagerView({el:$("#stats-player-stats .pagi-holder"),collection:this.collection,template:$("#pager-template")}),this.rounds=new root.Rounds(null,{service:this.collection.service}),this.matches=new root.Matches(null,{service:this.collection.service}),this.teams=new root.Teams(null,{service:this.collection.service}),this.roundsView=new root.RoundsView({el:this.$el.find('.filters select[name="round"]'),collection:this.rounds}),this.matchesView=new root.MatchesView({el:this.$el.find('.filters select[name="match"]'),collection:this.matches}),this.teamsView=new root.TeamsView({el:this.$el.find('.filters select[name="team"]'),collection:this.teams}),this.options.season_id&&(this.collection.setParam("season_id",this.options.season_id),this.rounds.setSeason(this.options.season_id)),this.collection.on("filter:enable",this.enableFilters,this)},enableFilters:function(){this.$el.find(".stats-options").removeClass("hide")},applyHeaderVisibility:function(filter){var filter=$(filter.currentTarget),checked=filter.is(":checked"),header=filter.data("header"),group=filter.data("group");if(checked){if(this.collection.groupLimitReached()){alert("The maximum number of stats that can be displayed is 11. Please remove stats before adding more.");var highlightBg="#ce1920",originalBg="#2E2E2E";return this.$el.find(".info-text").delay(500).css("color",highlightBg).delay(500).queue(function(){$(this).css("color",originalBg),$(this).dequeue()}),!1}header?this.collection.setHeaderVisible(header):this.collection.setGroupVisible(group)}else{if(this.collection._header(this.collection.activeSortHeader())==header||this.collection._group(this.collection.activeSortHeader)==group)return this.collection.resetDefaults(),void this.collection.sort();header?this.collection.setHeaderInvisible(header):this.collection.setGroupInvisible(group)}this.collection.trigger("paged")},resetHeaders:function(){return this.collection.resetDefaults(),this.collection.setIndexOn(this.collection._attribute(this.collection.activeSortHeader())),this.collection.sort(),this.collection.trigger("reset"),this.filters.trigger("reset-filters"),!1},filterYear:function(selector){var season=$(selector.currentTarget).val();this.collection.setParam("season_id",season),this.collection.unsetParam("round_id"),this.collection.unsetParam("match_id"),this.collection.unsetParam("team_id"),this.rounds.reset(),this.matches.reset(),this.teams.reset(),this.rounds.setSeason(season),this.collection.fetch(),this.collection.goTo(1)},filterRound:function(selector){var round=$(selector.currentTarget).val();round?(this.matches.setRound(round),this.collection.setParam("round_id",round)):(this.matches.reset(),this.collection.unsetParam("round_id")),this.collection.unsetParam("match_id"),this.collection.unsetParam("team_id"),this.collection.fetch(),this.collection.goTo(1)},filterMatch:function(selector){var match=$(selector.currentTarget).val();match?(this.teams.setMatch(match),this.collection.setParam("match_id",match)):(this.teams.reset(),this.collection.unsetParam("match_id")),this.collection.unsetParam("team_id"),this.collection.fetch(),this.collection.goTo(1)},filterTeam:function(selector){var team=$(selector.currentTarget).val();team?this.collection.setParam("team_id",team):this.collection.unsetParam("team_id"),this.collection.fetch(),this.collection.goTo(1)}})}).call(this.AFL.STATS),$(function(){AFL.STATS.PLAYERS.players=new AFL.STATS.PLAYERS.Players(!1,{service:AFL.service}),AFL.STATS.PLAYERS.statistics=new AFL.STATS.PLAYERS.Statistics({collection:AFL.STATS.PLAYERS.players,el:$("#stats-player-stats"),templates:{filter:$("#player-filters"),player:$("#player-template"),header:$("#player-header"),footer:$("#player-footer")},season_id:AFL.Properties.STATS.season_id}),AFL.STATS.PLAYERS.players.fetch(),$("#stats-player-stats .more-link").live("click",function(){return $("#stats-player-more").slideToggle(function(){$("#stats-player-stats .more-link a .arrow-icon").toggleClass("off")}),!1})});