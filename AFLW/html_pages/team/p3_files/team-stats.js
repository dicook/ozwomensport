(function(){var TEAMS,root=this;void 0===root.TEAMS&&(TEAMS=root.TEAMS={}),TEAMS.Team=Backbone.Model.extend({initialize:function(){this.id=this.get("team.teamId")},name:function(){return this.get("team.teamName")},value:function(header){var attribute=this.collection._attribute(this.collection.getHeader(header)),value=_.isNull(this.get(attribute))?"-":this.get(attribute);return value===this.collection.max(header)&&(value="<strong>"+value+"</strong>"),value},link:function(){return""}}),TEAMS.Teams=Backbone.Collection.extend({mixin:[Backbone.CollectionSortMixin,Backbone.IndexMixin,Backbone.URLRoutesMixin,Backbone.CollectionAggregatorMixin,Backbone.CachedCollectionMixin],model:TEAMS.Team,cache:new AFL.Cache,urlRoutes:["afl/statsCentre/teams?competitionId=:season_id","afl/statsCentre/teams?competitionId=:season_id&roundId=:round_id","afl/statsCentre/teams?competitionId=:season_id&roundId=:round_id&matchId=:match_id","afl/statsCentre/teams?competitionId=:season_id&roundId=:round_id&matchId=:match_id&teamIds=:team_id"],urlParams:{season_id:null,round_id:null,match_id:null,team_id:null},options:{sort:{sortable:!0,groupLimit:12,headers:[{header:"team",group:"team",attribute:"team.teamName",direction:"desc",sort:!0,visible:!0,init:!0,active:!0},{header:"tKicks",group:"kicks",attribute:"stats.totals.kicks",direction:"desc",sort:!0,visible:!0},{header:"aKicks",group:"kicks",attribute:"stats.averages.kicks",direction:"desc",sort:!0,visible:!0},{header:"tHandballs",group:"handballs",attribute:"stats.totals.handballs",direction:"desc",sort:!0,visible:!0},{header:"aHandballs",group:"handballs",attribute:"stats.averages.handballs",direction:"desc",sort:!0,visible:!0},{header:"tDisposals",group:"disposals",attribute:"stats.totals.disposals",direction:"desc",sort:!0,visible:!0},{header:"aDisposals",group:"disposals",attribute:"stats.averages.disposals",direction:"desc",sort:!0,visible:!0},{header:"tContestedPossessions",group:"contestedPossessions",attribute:"stats.totals.contestedPossessions",direction:"desc",sort:!0,visible:!1},{header:"aContestedPossessions",group:"contestedPossessions",attribute:"stats.averages.contestedPossessions",direction:"desc",sort:!0,visible:!1},{header:"tUncontestedPossessions",group:"uncontestedPossessions",attribute:"stats.totals.uncontestedPossessions",direction:"desc",sort:!0,visible:!1},{header:"aUncontestedPossessions",group:"uncontestedPossessions",attribute:"stats.averages.uncontestedPossessions",direction:"desc",sort:!0,visible:!1},{header:"disposalEfficiency",group:"disposalEfficiency",attribute:"stats.averages.disposalEfficiency",direction:"desc",sort:!0,visible:!1},{header:"tClangers",group:"clangers",attribute:"stats.totals.clangers",direction:"desc",sort:!0,visible:!1},{header:"aClangers",group:"clangers",attribute:"stats.averages.clangers",direction:"desc",sort:!0,visible:!1},{header:"tMarks",group:"marks",attribute:"stats.totals.marks",direction:"desc",sort:!0,visible:!0},{header:"aMarks",group:"marks",attribute:"stats.averages.marks",direction:"desc",sort:!0,visible:!0},{header:"tContestedMarks",group:"contestedMarks",attribute:"stats.totals.contestedMarks",direction:"desc",sort:!0,visible:!1},{header:"aContestedMarks",group:"contestedMarks",attribute:"stats.averages.contestedMarks",direction:"desc",sort:!0,visible:!1},{header:"tMarksInside50",group:"marksInside50",attribute:"stats.totals.marksInside50",direction:"desc",sort:!0,visible:!1},{header:"aMarksInside50",group:"marksInside50",attribute:"stats.averages.marksInside50",direction:"desc",sort:!0,visible:!1},{header:"tHitouts",group:"hitouts",attribute:"stats.totals.hitouts",direction:"desc",sort:!0,visible:!0},{header:"aHitouts",group:"hitouts",attribute:"stats.averages.hitouts",direction:"desc",sort:!0,visible:!0},{header:"tTotalClearances",group:"totalClearances",attribute:"stats.totals.clearances.totalClearances",direction:"desc",sort:!0,visible:!1},{header:"aTotalClearances",group:"totalClearances",attribute:"stats.averages.clearances.totalClearances",direction:"desc",sort:!0,visible:!1},{header:"tCentreClearances",group:"centreClearances",attribute:"stats.totals.clearances.centreClearances",direction:"desc",sort:!0,visible:!1},{header:"aCentreClearances",group:"centreClearances",attribute:"stats.averages.clearances.centreClearances",direction:"desc",sort:!0,visible:!1},{header:"tStoppageClearances",group:"stoppageClearances",attribute:"stats.totals.clearances.stoppageClearances",direction:"desc",sort:!0,visible:!1},{header:"aStoppageClearances",group:"stoppageClearances",attribute:"stats.averages.clearances.stoppageClearances",direction:"desc",sort:!0,visible:!1},{header:"tRebound50s",group:"rebound50s",attribute:"stats.totals.rebound50s",direction:"desc",sort:!0,visible:!1},{header:"aRebound50s",group:"rebound50s",attribute:"stats.averages.rebound50s",direction:"desc",sort:!0,visible:!1},{header:"tFreesFor",group:"freesFor",attribute:"stats.totals.freesFor",direction:"desc",sort:!0,visible:!0},{header:"aFreesFor",group:"freesFor",attribute:"stats.averages.freesFor",direction:"desc",sort:!0,visible:!0},{header:"tFreesAgainst",group:"freesAgainst",attribute:"stats.totals.freesAgainst",direction:"desc",sort:!0,visible:!0},{header:"aFreesAgainst",group:"freesAgainst",attribute:"stats.averages.freesAgainst",direction:"desc",sort:!0,visible:!0},{header:"tTackles",group:"tackles",attribute:"stats.totals.tackles",direction:"desc",sort:!0,visible:!0},{header:"aTackles",group:"tackles",attribute:"stats.averages.tackles",direction:"desc",sort:!0,visible:!0},{header:"tOnePercenters",group:"onePercenters",attribute:"stats.totals.onePercenters",direction:"desc",sort:!0,visible:!1},{header:"aOnePercenters",group:"onePercenters",attribute:"stats.averages.onePercenters",direction:"desc",sort:!0,visible:!1},{header:"tBounces",group:"bounces",attribute:"stats.totals.bounces",direction:"desc",sort:!0,visible:!1},{header:"aBounces",group:"bounces",attribute:"stats.averages.bounces",direction:"desc",sort:!0,visible:!1},{header:"tInside50s",group:"inside50s",attribute:"stats.totals.inside50s",direction:"desc",sort:!0,visible:!1},{header:"aInside50s",group:"inside50s",attribute:"stats.averages.inside50s",direction:"desc",sort:!0,visible:!1},{header:"tGoals",group:"goals",attribute:"stats.totals.goals",direction:"desc",sort:!0,visible:!0},{header:"aGoals",group:"goals",attribute:"stats.averages.goals",direction:"desc",sort:!0,visible:!0},{header:"tBehinds",group:"behinds",attribute:"stats.totals.behinds",direction:"desc",sort:!0,visible:!0},{header:"aBehinds",group:"behinds",attribute:"stats.averages.behinds",direction:"desc",sort:!0,visible:!0},{header:"tGoalAssists",group:"goalAssists",attribute:"stats.totals.goalAssists",direction:"desc",sort:!0,visible:!1},{header:"aGoalAssists",group:"goalAssists",attribute:"stats.averages.goalAssists",direction:"desc",sort:!0,visible:!1},{header:"goalAccuracy",group:"goalAccuracy",attribute:"stats.averages.goalAccuracy",direction:"desc",sort:!0,visible:!1},{header:"tDreamTeamPoints",group:"dreamTeamPoints",attribute:"stats.totals.dreamTeamPoints",direction:"desc",sort:!0,visible:!0},{header:"aDreamTeamPoints",group:"dreamTeamPoints",attribute:"stats.averages.dreamTeamPoints",direction:"desc",sort:!0,visible:!0},{header:"tInterchangeCounts",group:"interchangeCounts",attribute:"stats.totals.interchangeCounts.totalInterchangeCount",direction:"desc",sort:!0,visible:!1},{header:"aInterchangeCounts",group:"interchangeCounts",attribute:"stats.averages.interchangeCounts.totalInterchangeCount",direction:"desc",sort:!0,visible:!1}]},index:{indexable:!0,ignore:["team.teamName"],on:"team.teamName"}},initialize:function(models,options){options.service&&(this.service=options.service)},parse:function(response){return response.lists},max:function(header){var root=this,attr=this._attribute(this.getHeader(header));return this.cache.getSet("max:"+attr,function(){return root._super("max",[attr])})},sum:function(header){var root=this,attr=this._attribute(this.getHeader(header));return this.cache.getSet("sum:"+attr,function(){return root._super("sum",[attr])})},avg:function(header){var root=this,attr=this._attribute(this.getHeader(header));return this.cache.getSet("avg:"+attr,function(){return root._super("avg",[attr]).toFixed(1)})},error:function(collection){collection.reset(),collection.trigger("empty")},fetch:function(){var options={error:this.error};return this.cache.clear(),Backbone.Collection.prototype.fetch.call(this,options)}}),TEAMS.TeamView=Backbone.View.extend({mixin:[Backbone.ViewRowSortMixin],tagName:"tr",initialize:function(){this.template=_.template(this.options.template.html())},render:function(){var content=this.template({item:this.model,view:this});return this.$el.html(content),this}}),TEAMS.TeamsView=Backbone.View.extend({mixin:[Backbone.ViewSortMixin],events:{"click .sortable":"sort"},initialize:function(){_.bindAll(this,"addOne","render"),this.collection.on("reset",this.render,this),this.collection.on("sorted",this.render,this),this.collection.on("empty",this.renderEmpty,this)},render:function(){this.collection.trigger("filter:enable"),this.collection.trigger("enable-filters"),this.collection.length&&(this.$el.find("tbody").empty(),this.renderHeader(),this.renderFooter(),_.each(this.collection.models,this.addOne))},addOne:function(model,counter){if(!(counter>19)){var teamClass=_.indexOf(this.collection.models,model)%2===0?"":"stevens",view=new TEAMS.TeamView({model:model,template:this.options.templates.team,className:teamClass});this.$el.find("tbody").append(view.render().$el)}},renderHeader:function(){var header=this.$el.find("thead"),template=_.template(this.options.templates.header.html()),content=template({view:this});header.html(content)},renderFooter:function(){var footer=this.$el.find("tfoot"),template=_.template(this.options.templates.footer.html()),content=template({item:this.collection,view:this});footer.html(content)},renderEmpty:function(){this.$el.find("tbody").empty(),this.$el.find("tfoot").empty();var headers=this.collection.countVisibleHeaders(),element='<tr><td colspan="'+headers+'">No data available</td></tr>';this.$el.find("tbody").append(element)},sort:function(element){var header=$(element.currentTarget).data("sort");header&&this.headerSort(header)}}),TEAMS.FilterView=Backbone.View.extend({mixin:[Backbone.ViewSortMixin],initialize:function(){this.template=_.template(this.options.template.html()),this.on("reset-filters",this.render,this)},render:function(){var content=this.template({item:this});return this.$el.html(content),this}}),TEAMS.Statistics=Backbone.View.extend({events:{"click .filter-column":"applyHeaderVisibility","click #stats-team-more-reset":"resetHeaders",'change .filters select[name="year"]':"filterYear",'change .filters select[name="round"]':"filterRound",'change .filters select[name="match"]':"filterMatch"},initialize:function(){this.filters=new TEAMS.FilterView({el:$("#stats-team-more .groups"),collection:this.collection,template:this.options.templates.filter}),this.filters.trigger("reset-filters"),this.teamView=new TEAMS.TeamsView({el:$("#team-stats"),collection:this.collection,templates:{team:this.options.templates.team,header:this.options.templates.header,footer:this.options.templates.footer}}),this.rounds=new root.Rounds(null,{service:this.collection.service}),this.matches=new root.Matches(null,{service:this.collection.service}),this.roundsView=new root.RoundsView({el:this.$el.find('.filters select[name="round"]'),collection:this.rounds}),this.matchesView=new root.MatchesView({el:this.$el.find('.filters select[name="match"]'),collection:this.matches}),this.options.season_id&&(this.collection.setParam("season_id",this.options.season_id),this.rounds.setSeason(this.options.season_id)),this.collection.on("filter:enable",this.enableFilters,this),seasonnum=this.options.season_id.replace(/\D/g,""),seasonyr=seasonnum.substr(0,4);var interchangeCheckbox=$(".stats-options").find("#hInterchangeCounts");seasonyr<"2014"&&(this.collection.setGroupInvisible("interchangeCounts"),interchangeCheckbox.attr("disabled",!0),interchangeCheckbox.parent("li").css("opacity","0.4"))},enableFilters:function(){this.$el.find(".stats-options").removeClass("hide")},applyHeaderVisibility:function(filter){var filter=$(filter.currentTarget),checked=filter.is(":checked"),header=filter.data("header"),group=filter.data("group");if(checked){if(this.collection.groupLimitReached()){alert("The maximum number of stats that can be displayed is 11. Please remove stats before adding more.");var highlightBg="#ce1920",originalBg="#2E2E2E";return this.$el.find(".info-text").delay(500).css("color",highlightBg).delay(500).queue(function(){$(this).css("color",originalBg),$(this).dequeue()}),!1}header?this.collection.setHeaderVisible(header):this.collection.setGroupVisible(group)}else{if(this.collection._header(this.collection.activeSortHeader())==header||this.collection._group(this.collection.activeSortHeader)==group)return this.collection.resetDefaults(),void this.collection.sort();header?this.collection.setHeaderInvisible(header):this.collection.setGroupInvisible(group)}this.collection.trigger("reset")},showInterchange:function(){var seasonID=$('.filters select[name="year"]').val(),interchangeCheckbox=$(".stats-options").find("#hInterchangeCounts");seasonnumber=seasonID.replace(/\D/g,""),seasonyear=seasonnumber.substr(0,4),seasonyear<"2014"?(this.collection.setGroupInvisible("interchangeCounts"),interchangeCheckbox.attr("disabled",!0),interchangeCheckbox.parent("li").css("opacity","0.4")):(interchangeCheckbox.attr("disabled",!1),interchangeCheckbox.parent("li").css("opacity","1"),interchangeCheckbox.prop("checked")&&this.collection.setGroupVisible("interchangeCounts"))},resetHeaders:function(){return this.collection.resetDefaults(),this.collection.setIndexOn(this.collection._attribute(this.collection.activeSortHeader())),this.collection.sort(),this.collection.trigger("reset"),this.filters.trigger("reset-filters"),this.showInterchange(),!1},filterYear:function(selector){var season=$(selector.currentTarget).val();this.collection.setParam("season_id",season),this.collection.unsetParam("round_id"),this.collection.unsetParam("match_id"),this.rounds.reset(),this.matches.reset(),this.rounds.setSeason(season),this.collection.setHeaderAttributes({disposalEfficiency:"stats.averages.disposalEfficiency",goalAccuracy:"stats.averages.goalAccuracy"}),this.collection.fetch(),this.showInterchange()},filterRound:function(selector){var round=$(selector.currentTarget).val();round?(this.collection.setParam("round_id",round),this.matches.reset(),this.matches.setRound(round),this.collection.setHeaderAttributes({disposalEfficiency:"stats.totals.disposalEfficiency",goalAccuracy:"stats.totals.goalAccuracy"})):(this.matches.reset(),this.collection.unsetParam("round_id"),this.collection.setHeaderAttributes({disposalEfficiency:"stats.averages.disposalEfficiency",goalAccuracy:"stats.averages.goalAccuracy"})),this.collection.unsetParam("match_id"),this.collection.fetch()},filterMatch:function(selector){var match=$(selector.currentTarget).val();match?this.collection.setParam("match_id",match):this.collection.unsetParam("match_id"),this.collection.fetch()}})}).call(this.AFL.STATS),$(function(){AFL.STATS.TEAMS.teams=new AFL.STATS.TEAMS.Teams(!1,{service:AFL.service}),AFL.STATS.TEAMS.statistics=new AFL.STATS.TEAMS.Statistics({collection:AFL.STATS.TEAMS.teams,el:$("#stats-team-stats"),templates:{filter:$("#team-filters"),team:$("#team-template"),header:$("#team-header"),footer:$("#team-footer")},season_id:AFL.Properties.STATS.season_id}),AFL.STATS.TEAMS.teams.fetch(),$("#stats-team-stats .more-link").live("click",function(){return $("#stats-team-more").slideToggle(function(){$("#stats-team-stats .more-link a .arrow-icon").toggleClass("off")}),!1})});